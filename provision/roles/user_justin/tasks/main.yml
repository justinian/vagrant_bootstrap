- name: Adding user justin
  user: name=justin shell=/bin/bash groups=sudo,adm,users password={{crypted_pass}}
  register: justin_user_add

- name: Adding justin's dotfiles
  git: >
    repo=https://bitbucket.org/justinian/dotfiles.git
    dest=/home/justin/.dotfiles
    update=no
  sudo: yes
  sudo_user: justin
  when: justin_user_add|success
  register: justin_dotfiles_clone

- name: Adding justin's vim runtime
  git: >
    repo=https://github.com/justinian/vim_runtime.git
    dest=/home/justin/.vim
    update=no
  sudo: yes
  sudo_user: justin
  when: justin_user_add|success

- name: Installing jusitn's dotfiles
  when: justin_dotfiles_clone|success
  sudo: yes
  sudo_user: justin
  command: /home/justin/.dotfiles/.install
  args:
    chdir: /home/justin
    creates: /home/justin/.dotfiles.old

- name: Add host-specific bashrc
  when: justin_dotfiles_clone|success
  register: justin_local_bashrc
  lineinfile: >
    create=yes
    dest=/home/justin/.dotfiles/bashrc.d/hosts/{{ansible_hostname}}
    line={{item}}
  with_items:
    - "HOST_COLOR=\\'01;31m\\'"
    - "SKIP_ALUCARD=1"

- name: Adding justin's authorized_keys
  authorized_key: user=justin key=https://github.com/justinian.keys
  when: justin_user_add|success
